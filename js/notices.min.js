window.entrepot=window.entrepot||{},function(a){"undefined"!=typeof entrepotNoticesl10n&&(window.entrepot.Notices={getStorage:function(t,e){t=(t=localStorage.getItem(t))?JSON.parse(t):{};return void 0!==e&&t[e]?t[e]:t},setStorage:function(t,e,n){var o=this.getStorage(t);return void 0===n&&void 0!==o[e]?delete o[e]:o[e]=n,localStorage.setItem(t,JSON.stringify(o)),null!==localStorage.getItem(t)},refreshCount:function(t,e){var n,o=parseInt(a("#show-entrepot-notices-link .count").html(),10);e&&(n=parseInt(a("#tab-link-entrepot-notice-"+e+" .count").html(),10)),n-=t=t||0,(o-=t)<=0?(a("#show-entrepot-notices-link").hasClass("screen-meta-active")&&a("#show-entrepot-notices-link").trigger("click"),a("#screen-entrepot-notices-wrap").remove(),a("#entrepot-notices-link-wrap").remove()):(a("#show-entrepot-notices-link .count").html(o),e&&(n<=0?(o=a("#tab-link-entrepot-notice-"+e).parent(),a("#tab-link-entrepot-notice-"+e).remove(),o.children().length&&a(o).find("a").first().trigger("click")):a("#tab-link-entrepot-notice-"+e+" .count").html(n)))},injectNoticesCenter:function(){a("#screen-meta-links").length||a("#screen-meta").after(a("<div></div>").prop("id","screen-meta-links")),a("#screen-meta").append(a("<div></div>").prop({id:"screen-entrepot-notices-wrap",tabindex:"-1"}).addClass("hidden").append(a("<div></div>").prop("id","entrepot-notices-back")).append(a("<div></div>").prop("id","entrepot-notices-columns").append(a("<div></div>").addClass("contextual-help-tabs").html(a("<ul></ul>"))).append(a("<div></div>").addClass("contextual-help-tabs-wrap")))),a("#screen-meta-links").append(a("<div></div>").prop("id","entrepot-notices-link-wrap").addClass("hide-if-no-js screen-meta-toggle").html(a("<button></button>").prop({type:"button",id:"show-entrepot-notices-link"}).attr("aria-controls","screen-entrepot-notices-wrap").attr("aria-expanded",!1).addClass("button show-entrepot-notices show-settings").html(this.strings.tabTitle)))},populateNotices:function(){var i=this;i.encodedNotices={},a.each(i.notices,function(o,t){var n,e=["entrepot-notice-wrap"];i.encodedNotices[o]=[],t.length&&("upgrade"!==o&&e.push("entrepot-notice-trashable"),n=' class="'+e.join(" ")+'"',a("#screen-entrepot-notices-wrap .contextual-help-tabs ul").append(a("<li></li>").prop("id","tab-link-entrepot-notice-"+o).addClass(o).html(a("<a></a>").prop("href","#tab-panel-entrepot-notice-"+o).attr("aria-controls","tab-panel-entrepot-notice-"+o).html(i.strings.tabLiTitles[o]))),a.each(t,function(t,e){var n;e.id&&((n=i.getStorage("notices",o))&&-1!==a.inArray(e.id,n)||i.encodedNotices[o].push({id:e.id,content:e.short_text,fullContent:e.full_text}))}),i.encodedNotices[o].length?(i.encodedNotices[o].length!==t.length&&i.refreshCount(t.length-i.encodedNotices[o].length,o),a("#screen-entrepot-notices-wrap .contextual-help-tabs-wrap").append(a("<div></div>").prop("id","tab-panel-entrepot-notice-"+o).addClass("help-tab-content entrepot-"+o)),a.each(i.encodedNotices[o],function(t,e){a("#tab-panel-entrepot-notice-"+o).append("<div"+n+' data-id="'+e.id+'" data-type="'+o+'">'+e.content.replace("</p>",' <a href="#" class="show-notice"><span class="screen-reader-text">'+i.strings.show+"</span></a></p>")+"</div>")})):i.refreshCount(t.length,o))}),a("#screen-entrepot-notices-wrap .contextual-help-tabs ul li").first().addClass("active"),a("#screen-entrepot-notices-wrap .contextual-help-tabs-wrap div").first().addClass("active"),a.each(a("#screen-entrepot-notices-wrap .entrepot-notice-trashable"),function(t,e){a(e).append(a("<button></button>").prop("type","button").addClass("entrepot-notice-trash").html(a("<span></span>").addClass("screen-reader-text").text(i.strings.trash||"")))})},trashNotice:function(t){t.preventDefault();var e=a(t.currentTarget).parent(),t=this.getStorage("notices",e.data("type"));t.length||(t=[]),t.push(e.data("id")),this.setStorage("notices",e.data("type"),t),e.fadeTo(100,0,function(){e.slideUp(100,function(){e.remove()})}),this.refreshCount(1,e.data("type"))},showNotice:function(t){t.preventDefault();var n=a(t.currentTarget).closest(".entrepot-notice-wrap").data();void 0!==n.type&&void 0!==n.id&&this.encodedNotices[n.type]&&(t=this.encodedNotices[n.type],a.each(t,function(t,e){e.id!==n.id||a('[data-notice-id="'+n.id+'"]').length||(e=a(e.fullContent).addClass("notice is-dismissible").attr("data-notice-id",e.id),a("#wpbody-content .wrap h1").after(e),a(document).trigger("wp-updates-notice-added"))}))},switchActiveTab:function(t){var e=a(this);if(t.preventDefault(),e.is(".active a"))return!1;a("#screen-entrepot-notices-wrap .contextual-help-tabs .active").removeClass("active"),e.parent("li").addClass("active"),e=a(e.attr("href")),a("#screen-entrepot-notices-wrap .help-tab-content").not(e).removeClass("active").hide(),e.addClass("active").show()},init:function(){var n=this;a.extend(this,entrepotNoticesl10n,{hasNotice:!1}),a.each(this.notices,function(t,e){e.length&&(n.hasNotice=!0)}),this.hasNotice&&(this.injectNoticesCenter(),this.populateNotices(),a("#screen-entrepot-notices-wrap .contextual-help-tabs").on("click","a",this.switchActiveTab),a("#screen-entrepot-notices-wrap").on("click","button.entrepot-notice-trash",this.trashNotice.bind(this)),a("#screen-entrepot-notices-wrap").on("click","a.show-notice",this.showNotice.bind(this)))}},window.entrepot.Notices.init())}(jQuery);