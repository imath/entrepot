window.wp=window.wp||{},window.entrepot=window.entrepot||_.extend({},_.pick(window.wp,"apiRequest","template")),function(d,u,g){g.notice=g.template("entrepot-notice"),g.wpApiSettings=window.wpApiSettings||entrepotl10nPluginsOverwrite.wpApiSettings,g.upload=function(e,n,r){var t,i,s={"X-Requested-With":"XMLHttpRequest","X-WP-Nonce":g.wpApiSettings.nonce,"Cache-Control":"no-cache, must-revalidate, max-age=0"},a=g.wpApiSettings.root+e.replace(/^\//,"");for(i in n=n||{},(t="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(e){var n,t;e.currentTarget&&4===e.currentTarget.readyState&&(t=(n=JSON.parse(e.currentTarget.responseText)).status?n.status:e.currentTarget.status,r&&r(t,n))},t.open("POST",a),s)t.setRequestHeader(i,s[i]);t.send(n)},d(document).ready(function(){var t=g.template("entrepot-plugin-version"),r=d("#list-plugin-versions");g.apiRequest({path:"wp/v2/plugins/",type:"GET",dataType:"json"}).done(function(e){d("#entrepot-loading-plugins").remove(),d.each(e,function(e,n){r.append(t(n))}),d("img.plugin-icon").on("error",function(e){e.preventDefault(),d(e.currentTarget).parent().find(".dashicons-admin-plugins").first().removeClass("hide"),d(e.currentTarget).remove()})}).fail(function(e){var n={id:"list-plugin-versions-error",code:400};e&&e.responseJSON?u.extend(n,{code:e.responseJSON.status,message:e.responseJSON.message}):n.message=entrepotl10nPluginsOverwrite.unknownError,d("#entrepot-loading-plugins").html(g.notice(n))})}),d("#list-plugin-versions").on("change",'input[type="file"]',function(e){var n,t=d(e.currentTarget),r=t.prop("name"),i=new FormData,s=t.data("plugin-id"),a=t.parent().find("label").first(),o=t.parent().find(".update-now").first(),p=t.parents(".plugin-card");e.currentTarget.files&&(p.find("#notice-"+r).length&&p.find("#notice-"+r).remove(),n=u.first(e.currentTarget.files),/.zip*/.test(n.type)&&"zip"===n.name.substr(n.name.lastIndexOf(".")+1)?(a.addClass("updating"),o.addClass("updating-message"),i.append(r,n),i.append("id",s),t.val(""),g.upload("wp/v2/plugins/"+r+"/?package="+s,i,function(e,n){var t={id:"notice-"+r,code:e};a.removeClass("updating"),o.removeClass("updating-message"),200!==e?(t.message=entrepotl10nPluginsOverwrite.unknownError,n&&n.message&&(t.message=n.message)):(u.extend(t,{message:n.message}),n.newVersion&&n.oldVersion&&a.html(a.html().replace(n.oldVersion,n.newVersion))),p.append(g.notice(t)),d(document).trigger("wp-updates-notice-added")})):p.append(g.notice({id:"notice-"+r,code:403,message:entrepotl10nPluginsOverwrite.filetypeError})))})}(jQuery,_,window.entrepot);