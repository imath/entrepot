window.wp=window.wp||{},window.entrepot=window.entrepot||_.extend({},_.pick(window.wp,"apiRequest","template")),function(p,d,u){u.notice=u.template("entrepot-notice"),u.wpApiSettings=window.wpApiSettings||entrepotl10nPluginsOverwrite.wpApiSettings,u.upload=function(e,n,t){var r,i,s={"X-Requested-With":"XMLHttpRequest","X-WP-Nonce":u.wpApiSettings.nonce,"Cache-Control":"no-cache, must-revalidate, max-age=0"},e=u.wpApiSettings.root+e.replace(/^\//,"");for(i in n=n||{},(r="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(e){var n;e.currentTarget&&4===e.currentTarget.readyState&&(e=(n=JSON.parse(e.currentTarget.responseText)).status||e.currentTarget.status,t&&t(e,n))},r.open("POST",e),s)r.setRequestHeader(i,s[i]);r.send(n)},p(document).ready(function(){var t=u.template("entrepot-plugin-version"),r=p("#list-plugin-versions");u.apiRequest({path:"wp/v2/plugins/",type:"GET",dataType:"json"}).done(function(e){p("#entrepot-loading-plugins").remove(),p.each(e,function(e,n){r.append(t(n))}),p("img.plugin-icon").on("error",function(e){e.preventDefault(),p(e.currentTarget).parent().find(".dashicons-admin-plugins").first().removeClass("hide"),p(e.currentTarget).remove()})}).fail(function(e){var n={id:"list-plugin-versions-error",code:400};e&&e.responseJSON?d.extend(n,{code:e.responseJSON.status,message:e.responseJSON.message}):n.message=entrepotl10nPluginsOverwrite.unknownError,p("#entrepot-loading-plugins").html(u.notice(n))})}),p("#list-plugin-versions").on("change",'input[type="file"]',function(e){var n=p(e.currentTarget),r=n.prop("name"),t=new FormData,i=n.data("plugin-id"),s=n.parent().find("label").first(),a=n.parent().find(".update-now").first(),o=n.parents(".plugin-card");e.currentTarget.files&&(o.find("#notice-"+r).length&&o.find("#notice-"+r).remove(),e=d.first(e.currentTarget.files),/.zip*/.test(e.type)&&"zip"===e.name.substr(e.name.lastIndexOf(".")+1)?(s.addClass("updating"),a.addClass("updating-message"),t.append(r,e),t.append("id",i),n.val(""),u.upload("wp/v2/plugins/"+r+"/?package="+i,t,function(e,n){var t={id:"notice-"+r,code:e};s.removeClass("updating"),a.removeClass("updating-message"),200!==e?(t.message=entrepotl10nPluginsOverwrite.unknownError,n&&n.message&&(t.message=n.message)):(d.extend(t,{message:n.message}),n.newVersion&&n.oldVersion&&s.html(s.html().replace(n.oldVersion,n.newVersion))),o.append(u.notice(t)),p(document).trigger("wp-updates-notice-added")})):o.append(u.notice({id:"notice-"+r,code:403,message:entrepotl10nPluginsOverwrite.filetypeError})))})}(jQuery,_,window.entrepot);