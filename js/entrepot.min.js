window.wp=window.wp||{},window.entrepot=window.entrepot||_.extend({},_.pick(window.wp,"Backbone","template")),function(o){"undefined"!=typeof entrepotl10n&&(o(document).ready(function(){o("body").addClass("entrepot-install-php");var e=o(".plugin-install-php .wp-filter-search"),t={margin:0,width:"280px","font-size":"16px","font-weight":300,"line-height":1.5,padding:"3px 5px",height:"32px"};5.5<=entrepotl10n.wpVersion&&(t={display:"inline-block","margin-top":"10px","vertical-align":"top"}),o(e).removeClass("wp-filter-search").prop("id","entrepot-search").css(t),o('#typeselector [value="tag"]').remove(),o("#the-list").css({"margin-top":"2em"})}),entrepot.Views=entrepot.Views||{},entrepot.View=entrepot.Backbone.View.extend({prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}}}),entrepot.Views.Card=entrepot.View.extend({className:"plugin-card",template:entrepot.template("entrepot-repository"),initialize:function(){var e=this.model.get("description"),t="",i=entrepotl10n.defaultIcon,t=_.isUndefined(e[entrepotl10n.locale])?e.en_US:e[entrepotl10n.locale],n=this.model.get("author");this.model.get("author_url")&&(n='<a href="'+this.model.get("author_url")+'">'+n+"</a>"),n=entrepotl10n.byAuthor.replace("%s",n),this.model.get("icon")&&(i=this.model.get("icon")),this.model.set({presentation:t,icon:i,author:n},{silent:!0}),this.model.get("name")&&(this.el.className+=" plugin-card-"+this.model.get("slug")),this.$el.prop("id",this.model.get("id"))}}),entrepot.Views.List=entrepot.View.extend({initialize:function(){_.each(this.collection.models,function(e){this.displayRepository(e)},this),o("#entrepot-search").on("keyup input",_.bind(this.searchRepositories,this)),o("#typeselector").on("change",this.resetSearch)},displayRepository:function(e){this.views.add(new entrepot.Views.Card({model:e}))},searchRepositories:function(e){var i=o("#typeselector").val(),n=o(e.currentTarget).val().toLowerCase();e.preventDefault(),n?_.each(this.collection.models,function(e){var t=o("#"+e.get("id"));"term"===i&&-1===e.get("name").toLowerCase().indexOf(n)&&-1===e.get("presentation").toLowerCase().indexOf(n)||"author"===i&&-1===e.get("author").toLowerCase().indexOf(n)?t.addClass("hide-if-js"):t.removeClass("hide-if-js")}):o("#the-list .plugin-card").removeClass("hide-if-js")},resetSearch:function(e){e.preventDefault(),o("#entrepot-search").val(""),o("#the-list .plugin-card").removeClass("hide-if-js")}}),entrepot.App={init:function(e){this.views=new Backbone.Collection,this.repositories=new Backbone.Collection(e),this.list=new entrepot.Views.List({el:o("#the-list"),collection:this.repositories}).render()}},o.getJSON(entrepotl10n.url,function(e){return!!e&&(e.sort(function(){return.5-Math.random()}),void entrepot.App.init(e))}).fail(function(e){o("#the-list").append('<div id="message" class="error"><p>'+o.parseJSON(e.responseText)+"</p></div>")}))}(jQuery);